---
import "../styles/global.css";
import BuilderProgress from "@components/builder/BuilderProgress";
import FormatSelector from "@components/builder/FormatSelector";
import IslandErrorBoundary from "@components/builder/IslandErrorBoundary";
import PlaceholderPanel from "@components/builder/PlaceholderPanel";
import { ensureDefaultFormatsRegistered } from "@/lib/tournament/formats/registry-seed";

ensureDefaultFormatsRegistered();
---

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <title>TournaGen · Builder</title>
    </head>
    <body class="surface font-sans">
        <main class="min-h-screen bg-gradient-to-b from-surface-50 via-white to-surface-50">
            <header class="sticky top-0 z-10 border-b border-neutral-200/70 bg-white/90 backdrop-blur">
                <div class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4">
                    <a class="flex items-center gap-2 font-display text-xl text-neutral-900" href="/">
                        <span class="rounded-lg bg-brand-600 px-2 py-1 text-sm font-semibold text-white shadow-soft">
                            TG
                        </span>
                        <span>TournaGen Builder</span>
                    </a>
                    <nav aria-label="Primary">
                        <ul class="flex items-center gap-3 text-sm font-semibold text-neutral-700">
                            <li>
                                <a class="rounded-lg px-3 py-2 hover:bg-neutral-100" href="/">
                                    Landing
                                </a>
                            </li>
                            <li>
                                <a class="rounded-lg bg-brand-50 px-3 py-2 text-brand-800 border border-brand-100 shadow-soft" href="/builder">
                                    Builder
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </header>

            <section class="px-6 py-10 sm:py-12">
                <div class="mx-auto max-w-6xl space-y-6">
                    <div class="card border-brand-100 bg-white/95 p-6 shadow-soft sm:p-8">
                        <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
                            <div class="space-y-3">
                                <div class="flex flex-wrap items-center gap-2">
                                    <span class="pill">Builder</span>
                                    <span class="pill bg-white text-neutral-700 border-neutral-200">
                                        Guided setup
                                    </span>
                                </div>
                                <div class="space-y-2">
                                    <h1 class="font-display text-3xl leading-tight text-neutral-900">
                                        Build tournaments with a guided, stepwise flow.
                                    </h1>
                                    <p class="max-w-3xl text-lg text-neutral-700">
                                        Configure the format, tune options, manage participants, and preview
                                        the structure—all in the browser with clear progress indicators and
                                        resilient error handling for every interactive island.
                                    </p>
                                </div>
                            </div>
                            <div class="rounded-xl border border-brand-100 bg-brand-50 px-5 py-4 text-sm text-brand-900 shadow-soft">
                                <p class="font-semibold">Client-side only</p>
                                <p class="text-neutral-800">
                                    Hydrates only the builder islands using Astro directives to stay fast.
                                </p>
                            </div>
                        </div>
                    </div>

                    <BuilderProgress client:load />

                    <div class="grid gap-5 lg:grid-cols-2">
                        <section
                            class="card border-brand-100 bg-white/95 p-5 shadow-soft lg:col-span-2"
                            aria-labelledby="format-selector-heading"
                        >
                            <div class="flex items-center justify-between gap-3 pb-3">
                                <div>
                                    <p class="text-xs font-semibold uppercase tracking-wide text-brand-700">
                                        Step 1 · Format
                                    </p>
                                    <h2
                                        id="format-selector-heading"
                                        class="text-xl font-semibold text-neutral-900"
                                    >
                                        Select a tournament format
                                    </h2>
                                </div>
                                <span class="rounded-full bg-brand-50 px-3 py-1 text-xs font-semibold text-brand-800">
                                    Registry-driven
                                </span>
                            </div>
                            <IslandErrorBoundary
                                client:load
                                title="Format selection"
                            >
                                <FormatSelector client:load />
                            </IslandErrorBoundary>
                        </section>

                        <section
                            class="card border-neutral-200 bg-white/95 p-5 shadow-soft"
                            aria-labelledby="config-panel-heading"
                        >
                            <div class="flex items-center justify-between gap-3 pb-3">
                                <div>
                                    <p class="text-xs font-semibold uppercase tracking-wide text-neutral-700">
                                        Step 2 · Configuration
                                    </p>
                                    <h2
                                        id="config-panel-heading"
                                        class="text-xl font-semibold text-neutral-900"
                                    >
                                        Configure format options
                                    </h2>
                                </div>
                                <span class="rounded-full bg-neutral-100 px-3 py-1 text-xs font-semibold text-neutral-700">
                                    Hydrates on demand
                                </span>
                            </div>
                            <IslandErrorBoundary
                                client:idle
                                title="Configuration panel"
                            >
                                <PlaceholderPanel
                                    title="Config panel island"
                                    description="Controls for seeding, rounds, and format-specific toggles will appear here."
                                />
                            </IslandErrorBoundary>
                        </section>

                        <section
                            class="card border-neutral-200 bg-white/95 p-5 shadow-soft"
                            aria-labelledby="participants-heading"
                        >
                            <div class="flex items-center justify-between gap-3 pb-3">
                                <div>
                                    <p class="text-xs font-semibold uppercase tracking-wide text-neutral-700">
                                        Step 3 · Participants
                                    </p>
                                    <h2
                                        id="participants-heading"
                                        class="text-xl font-semibold text-neutral-900"
                                    >
                                        Manage participants
                                    </h2>
                                </div>
                                <span class="rounded-full bg-accent-50 px-3 py-1 text-xs font-semibold text-accent-800">
                                    Fine-grained updates
                                </span>
                            </div>
                            <IslandErrorBoundary
                                client:idle
                                title="Participant manager"
                            >
                                <PlaceholderPanel
                                    title="Participant manager island"
                                    description="Add, edit, reorder, and enrich participants with seeds or metadata."
                                />
                            </IslandErrorBoundary>
                        </section>

                        <section
                            class="card border-neutral-200 bg-white/95 p-5 shadow-soft lg:col-span-2"
                            aria-labelledby="visualization-heading"
                        >
                            <div class="flex items-center justify-between gap-3 pb-3">
                                <div>
                                    <p class="text-xs font-semibold uppercase tracking-wide text-neutral-700">
                                        Step 4 · Review
                                    </p>
                                    <h2
                                        id="visualization-heading"
                                        class="text-xl font-semibold text-neutral-900"
                                    >
                                        Preview structure & export
                                    </h2>
                                </div>
                                <span class="rounded-full bg-neutral-100 px-3 py-1 text-xs font-semibold text-neutral-700">
                                    Client:visible
                                </span>
                            </div>
                            <IslandErrorBoundary
                                client:visible
                                title="Visualization"
                            >
                                <PlaceholderPanel
                                    title="Visualization island"
                                    description="Bracket, schedule, or leaderboard views render here before exporting."
                                />
                            </IslandErrorBoundary>
                        </section>
                    </div>
                </div>
            </section>
        </main>
    </body>
</html>
